<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Renderify Killer Demo: One-Line Chat Dashboard</title>
    <style>
      :root {
        --bg: #f4f7fb;
        --panel: #ffffff;
        --ink: #152339;
        --muted: #5d6f86;
        --line: #d8e1ec;
        --accent: #0f766e;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        background: radial-gradient(circle at 5% 10%, #d8f4ef 0, var(--bg) 42%);
        color: var(--ink);
        font-family: "IBM Plex Sans", "Segoe UI", sans-serif;
      }

      .page {
        max-width: 1120px;
        margin: 0 auto;
        padding: 20px;
      }

      .headline {
        margin: 0 0 8px;
        font-size: 26px;
      }

      .hint {
        margin: 0 0 14px;
        color: var(--muted);
      }

      .layout {
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: 14px;
      }

      .panel {
        background: var(--panel);
        border: 1px solid var(--line);
        border-radius: 12px;
        padding: 14px;
      }

      .chat-bubble {
        border-radius: 12px;
        background: #edf3fb;
        padding: 10px;
        color: #21344f;
        margin-bottom: 10px;
      }

      .mount {
        min-height: 360px;
        border: 1px dashed #bfd5cb;
        border-radius: 12px;
        padding: 10px;
        background: #fbfffe;
      }

      .status {
        margin-top: 8px;
        color: var(--muted);
        font-size: 13px;
      }

      pre {
        margin: 0;
        max-height: 220px;
        overflow: auto;
        border-radius: 8px;
        padding: 10px;
        background: #0e1e33;
        color: #d8e8ff;
        font-size: 12px;
      }

      @media (max-width: 960px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <h1 class="headline">One-Line Embed: AI Chat Dashboard</h1>
      <p class="hint">
        Goal: drop a single call into chat UI and render a fully interactive dashboard.
      </p>

      <div class="layout">
        <section class="panel">
          <div class="chat-bubble">
            User: Build an analytics dashboard with KPI toggles and chart.
          </div>
          <div class="chat-bubble">
            Assistant emitted RuntimePlan + TSX source. Render immediately.
          </div>
          <pre id="apiSnippet"></pre>
          <div id="status" class="status">Rendering...</div>
        </section>

        <section class="panel">
          <div id="mount" class="mount"></div>
        </section>
      </div>
    </div>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
      {
        "imports": {
          "@renderify/ir": "../../packages/ir/dist/ir.esm.js",
          "@renderify/security": "../../packages/security/dist/security.esm.js",
          "es-module-lexer": "https://ga.jspm.io/npm:es-module-lexer@1.7.0/dist/lexer.js",
          "preact": "https://ga.jspm.io/npm:preact@10.28.3/dist/preact.module.js",
          "preact/hooks": "https://ga.jspm.io/npm:preact@10.28.3/hooks/dist/hooks.module.js",
          "preact/jsx-runtime": "https://ga.jspm.io/npm:preact@10.28.3/jsx-runtime/dist/jsxRuntime.module.js",
          "preact-render-to-string": "https://ga.jspm.io/npm:preact-render-to-string@6.6.5/dist/index.module.js"
        }
      }
    </script>
    <script type="module">
      import { renderPlanInBrowser } from "../../packages/runtime/dist/runtime.esm.js";

      const plan = {
        specVersion: "runtime-plan/v1",
        id: "killer_chat_dashboard",
        version: 1,
        root: { type: "text", value: "loading" },
        capabilities: {
          domWrite: true,
          allowedModules: ["preact", "preact/hooks"],
          maxExecutionMs: 5000,
        },
        imports: ["preact", "preact/hooks"],
        moduleManifest: {
          preact: {
            resolvedUrl: "https://ga.jspm.io/npm:preact@10.28.3/dist/preact.module.js",
            signer: "examples",
          },
          "preact/hooks": {
            resolvedUrl: "https://ga.jspm.io/npm:preact@10.28.3/hooks/dist/hooks.module.js",
            signer: "examples",
          },
          "preact/jsx-runtime": {
            resolvedUrl: "https://ga.jspm.io/npm:preact@10.28.3/jsx-runtime/dist/jsxRuntime.module.js",
            signer: "examples",
          },
        },
        source: {
          language: "tsx",
          runtime: "preact",
          exportName: "default",
          code: [
            "import { h } from 'preact';",
            "import { useMemo, useState } from 'preact/hooks';",
            "",
            "export default function Dashboard() {",
            "  const [metric, setMetric] = useState('revenue');",
            "  const data = useMemo(() => [",
            "    { day: 'Mon', revenue: 120, users: 44 },",
            "    { day: 'Tue', revenue: 176, users: 58 },",
            "    { day: 'Wed', revenue: 148, users: 52 },",
            "    { day: 'Thu', revenue: 222, users: 74 },",
            "    { day: 'Fri', revenue: 261, users: 91 },",
            "  ], []);",
            "  const key = metric === 'revenue' ? 'revenue' : 'users';",
            "  const width = 560;",
            "  const height = 280;",
            "  const pad = 28;",
            "  const max = Math.max(...data.map((entry) => entry[key]));",
            "  const points = data.map((entry, index) => {",
            "    const x = pad + (index * (width - pad * 2)) / Math.max(1, data.length - 1);",
            "    const y = height - pad - (entry[key] / Math.max(1, max)) * (height - pad * 2);",
            "    return { x, y, day: entry.day, value: entry[key] };",
            "  });",
            "  const polyline = points.map((point) => `${point.x},${point.y}`).join(' ');",
            "  return (",
            "    <section style={{ fontFamily: 'IBM Plex Sans, sans-serif' }}>",
            "      <h2 style={{ margin: '0 0 6px' }}>Revenue Assistant Dashboard</h2>",
            "      <p style={{ marginTop: 0, color: '#4b5f79' }}>Generated by LLM, rendered by Renderify runtime.</p>",
            "      <div style={{ display: 'flex', gap: 8, marginBottom: 12 }}>",
            "        <button type='button' onClick={() => setMetric('revenue')}>Revenue</button>",
            "        <button type='button' onClick={() => setMetric('users')}>Users</button>",
            "      </div>",
            "      <div style={{ overflowX: 'auto' }}>",
            "        <svg width={width} height={height} viewBox={`0 0 ${width} ${height}`} role='img' aria-label='Metric chart'>",
            "          <line x1={pad} y1={height - pad} x2={width - pad} y2={height - pad} stroke='#d1d8e6' />",
            "          <line x1={pad} y1={pad} x2={pad} y2={height - pad} stroke='#d1d8e6' />",
            "          <polyline",
            "            fill='none'",
            "            stroke={metric === 'revenue' ? '#0f766e' : '#1d4ed8'}",
            "            strokeWidth={3}",
            "            points={polyline}",
            "          />",
            "          {points.map((point) => (",
            "            <g key={point.day}>",
            "              <circle cx={point.x} cy={point.y} r={4} fill={metric === 'revenue' ? '#0f766e' : '#1d4ed8'} />",
            "              <text x={point.x} y={height - 8} textAnchor='middle' fontSize='11' fill='#5c6f88'>{point.day}</text>",
            "              <text x={point.x} y={point.y - 10} textAnchor='middle' fontSize='11' fill='#2a3f58'>{point.value}</text>",
            "            </g>",
            "          ))}",
            "        </svg>",
            "      </div>",
            "      <p style={{ marginBottom: 0 }}>Current metric: <strong>{metric}</strong></p>",
            "    </section>",
            "  );",
            "}",
          ].join("\n"),
        },
      };

      const statusEl = document.getElementById("status");
      const snippetEl = document.getElementById("apiSnippet");
      snippetEl.textContent = "await renderPlanInBrowser(plan, { target: '#mount' });";

      (async () => {
        try {
          await renderPlanInBrowser(plan, { target: "#mount" });
          statusEl.textContent = "Rendered with one line API.";
        } catch (error) {
          statusEl.textContent = `Render failed: ${error?.message ?? String(error)}`;
        }
      })();
    </script>
  </body>
</html>
